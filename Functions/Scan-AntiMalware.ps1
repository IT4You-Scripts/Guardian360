# Realiza a Varredura contra Malwares
function Scan-AntiMalware {
    Write-Host "Iniciando varredura rápida de malwares (Windows Defender)..." -ForegroundColor Cyan
    
    # Localização padrão do utilitário do Defender
    $defenderPath = "C:\Program Files\Windows Defender\MpCmdRun.exe"
    
    if (Test-Path $defenderPath) {
        try {
            # Atualiza as assinaturas de vírus antes da varredura
            Write-Host "Atualizando definições de vírus..." -ForegroundColor Yellow
			Write-Log "Atualizando definições de vírus..." 
			Write-Log "" 
            Start-Process -FilePath $defenderPath -ArgumentList "-SignatureUpdate" -Wait -WindowStyle Hidden

            # Executa Scan Rápido (ScanType 1)
            # ScanType 2 seria o completo, mas pode levar horas.
            Write-Host "Executando varredura rápida..." -ForegroundColor Yellow
            Write-Log "Executando varredura rápida..." 
			Write-Log "" 
			$result = Start-Process -FilePath $defenderPath -ArgumentList "-Scan -ScanType 1" -Wait -PassThru -WindowStyle Hidden
            
            if ($result.ExitCode -eq 0) {
                Write-Host "Nenhuma ameaça detectada." -ForegroundColor Green
	            Write-Log "Nenhuma ameaça detectada." 
				Write-Log "" 			
            } elseif ($result.ExitCode -eq 2) {
                Write-Host "Ameaças detectadas e tratadas (ou exigem ação)!" -ForegroundColor Red
				Write-Log "Ameaças detectadas e tratadas (ou exigem ação)!" 
				Write-Log "" 		
            }
        } catch {
            Write-Log "Erro ao executar Windows Defender Scan: $_"
        }
    }
}
